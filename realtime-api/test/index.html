<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    <script src="
    https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js
    "></script>
    <title>Document</title>

</head>

<body>
    <h1>Testing client websocket for logistic web api (DELIVERYMAN)</h1>
</body>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    window.onload = async function () {
        const { data } = await axios.post('http://costumer-api.westus3.cloudapp.azure.com/api/commons/login/', {
            email: "entregador@gmail.com", 
            password: "12345678"
        });

        const { token } = data

        var socket = io.connect("http://costumer-api.westus3.cloudapp.azure.com", {
            query: { token }
        });

        socket.on("intent_of_travel", (data) => {
            loadNotification(data, socket)
        })
    }
    function acceptedTravel(data, socket) {
        socket.emit("intent_of_travel", { order: data.order, accepted: true, route: data.route })
        localStorage.setItem('travel', JSON.stringify({ order: data.order, accepted: true }))
    }
    function loadNotification(data, socket) {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        })

        swalWithBootstrapButtons.fire({
            title: 'Nova Viajem!!',
            text: "QUER ACEITAR???",
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'ACEITAR',
            cancelButtonText: 'NAO QUERO',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                acceptedTravel(data, socket)

                swalWithBootstrapButtons.fire(
                    'Aceita!!',
                    'Corrida aceita!.',
                    'success'
                )
            } else if (
                /* Read more about handling dismissals below */
                result.dismiss === Swal.DismissReason.cancel
            ) {
                swalWithBootstrapButtons.fire(
                    ': (',
                    'Tudo bem vamos passar para o proximo : (',
                    'error'
                )
            }
        })
    }
</script>

</html>