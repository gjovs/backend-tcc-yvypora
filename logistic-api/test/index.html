<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    <script src="
    https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js
    "></script>
    <title>Document</title>

</head>

<body>
    <h1>Testing client websocket for logistic web api (DELIVERYMAN)</h1>
</body>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<script>
    window.onload = function () {
        var socket = io.connect("ws://localhost:3337", {
            query: { token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7ImlkIjoxLCJuYW1lIjoiTHVhbmEgQ2FtaWxsYSIsImVtYWlsIjoiZW50cmVnYWRvckBnbWFpbC5jb20iLCJwYXNzd29yZF9oYXNoIjoiJDJhJDA2JEdFMG00WndnWE5tdFQzczl3TnFBRk9hQ3BiakRKLjdQRDNOT2ZUV2NNM0VSaHNPalZwdnVlIiwicGljdHVyZV91cmkiOiJodHRwczovL2VuY3J5cHRlZC10Ym4wLmdzdGF0aWMuY29tL2ltYWdlcz9xPXRibjpBTmQ5R2NULTdNLW8yVkl6cGNkVmN1bFFNWXFKZ3ZzSlFWRGZFOEphZU81c0RXVVB4SDhERjJnN0dFNmdzdTNmVWNQWW9vZ2RMT0kmdXNxcD1DQVUiLCJsb2NhdGlvbklkIjoyLCJvbmxpbmUiOmZhbHNlLCJjcmVhdGVkX2F0IjoiMjAyMy0wNC0xOVQxMzo0NDozMy4zOTZaIiwidXBkYXRlZF9hdCI6IjIwMjMtMDQtMTlUMTM6NDQ6MzMuMzk2WiIsImdlbmRlcklkIjoxLCJiaXJ0aGRheSI6IjIwMDYtMDQtMDQiLCJ0eXBlb2YiOiJERUxJVkVSWU1BTiJ9LCJpYXQiOjE2ODE5MTI0MjcsImV4cCI6MTY4MjUxNzIyN30.4wlvtYpTmlgYDl600BQchocNCNbtwLhzbLL_KsWR1rI" }
        });
        
        socket.on("intent_of_travel", (data) => {
            loadNotification(data, socket)
        })
    }
    function acceptedTravel(data, socket) {
        socket.emit("intent_of_travel", { order: data.order, accepted: true })
    }
    function loadNotification(data, socket) {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        })

        swalWithBootstrapButtons.fire({
            title: 'Nova Viajem!!',
            text: "QUER ACEITAR???",
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'ACEITAR',
            cancelButtonText: 'NAO QUERO',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                acceptedTravel(data, socket)

                swalWithBootstrapButtons.fire(
                    'Aceita!!',
                    'Corrida aceita!.',
                    'success'
                )
            } else if (
                /* Read more about handling dismissals below */
                result.dismiss === Swal.DismissReason.cancel
            ) {
                swalWithBootstrapButtons.fire(
                    ': (',
                    'Tudo bem vamos passar para o proximo : (',
                    'error'
                )
            }
        })
    }
</script>

</html>